-----------------------------------------
join_logo_scp用の実行内容スクリプト
コマンド説明  ver3.0対応
-----------------------------------------

【基本】
・ファイル先頭から１行ずつ実行する。
・カット位置が確定した所は以降の実行条件は無視する。
・カット位置が最後まで確定しなかった所はCMカットを行わない。
・先頭文字が # の行はコメントとして読み飛ばす。途中の#以降も読み飛ばす。
・ロゴ表示終了から補正した場所がCMカット開始位置、
  次のロゴ表示開始から補正した場所がCMカット終了位置となる。


【コマンド】
１行毎に下記項目を記載する。

コマンド コマンド引数 オプション


■コマンドおよびコマンド引数一覧

下記コマンド説明で、S/E/BはSEBのどれか１文字を表し、ロゴ表示開始または終了の
どちらを選ぶか決める。S:開始,E:終了,B:両方を表す。

記載中のロゴ位置とは、（オプションで変更しない限り）ロゴ開始／終了位置から
起動時オプションCutMrgIn/CutMrgOutで補正した所を表す。


■実行コマンド

  Find  S/E/B 中心指定 範囲先頭 範囲末尾
    ロゴ位置を基準に無音シーンチェンジ場所を探す。
    指定範囲内にあれば、中心指定に最も近い場所をCMカット位置として確定する。

  Force S/E/B 指定位置
    ロゴ位置を基準に指定位置だけ補正した場所をCMカット位置として確定する。
    無音シーンチェンジ情報は使わない。

  Abort S/E/B
    ロゴ位置のCMカットは行わないことを確定する。

  MkLogo S/E/B 中心指定 範囲先頭 範囲末尾
    ロゴ位置を基準に指定範囲にある無音シーンチェンジを開始位置とする仮想ロゴ
    を作成する。指定範囲内に複数ある場合は中心指定に一番近い場所とする。
    終了位置は -EndLen オプションで指定する。
    通常は仮想ロゴ範囲内に既存ロゴがない場合のみ有効であるが、
    -overlapオプションを付けた場合は既存ロゴに関係なく作成する。
    AutoCutコマンド前に入れたらAuto系コマンドにも反映される。

（例）MkLogo E 300 290 310 -N -1 -EndLen 600 590 610
    基準とするロゴは最終ロゴ（-N -1）表示終了（E）位置で、基準から
    １０秒後（290〜310フレーム）のシーンチェンジを仮想ロゴ開始位置とする。
    仮想ロゴ開始位置から２０秒後（590〜610フレーム）のシーンチェンジがあれば
    仮想ロゴ終了位置として設定が有効になる。


  DivLogo S/E/B 中心指定 範囲先頭 範囲末尾
    ロゴ位置を基準に指定範囲にある無音シーンチェンジが同じロゴ内であれば
    ロゴを分割する。指定範囲内に複数ある場合は中心指定に一番近い場所とする。
    このコマンドでロゴ分割した場合、出力AVSのTrimも分割される。
    明示的な区切りを入れたい場合に設定する。(ver2.1追加)

  Select S/E/B 中心指定 範囲先頭 範囲末尾
    ロゴ位置が自動検出では決定できない時、ロゴ可能性範囲内でSelect指定範囲内の
    無音シーンチェンジがあれば中心指定に一番近い場所を選択する。
    選択された場所はロゴ位置となり、CM間隔から自動検出した時と同様Findコマンド
    では（-flatオプション指定時を除き）優先して選択される。
    -resetオプションを付けるとロゴ位置検出できている時でも実行。
    -logoextオプションでロゴ可能性範囲を広げて検索可能。

  Default 変数名 設定値
  Set  変数名 設定値
    どちらも変数に値を設定。Defaultは変数が未定義時のみ反映される。
    使用時は変数名の先頭に$をつけた名前を置くことで設定値に置換される。
    通常は$の後一致する一番長い変数名になるが、${変数名}の形式で明示も可能。
    最初から設定されていて使用可能なシステム変数として下記あり。
      $MAXFRAME：最終フレーム値(ver2.1追加)
      $MAXTIME ：最終フレーム時間表記(ver3.0追加)
      $NOLOGO  ：ロゴなし時に1、ロゴあり時に0(ver2.1追加)
      $LASTEXE ：直前コマンドの実行状態（0:実行なし 1:実行）(ver2.1追加)
      $HEADFRAME : -Fhead/-Ftail/-Fmidオプション指定時に利用される(ver2.1追加)
      $TAILFRAME : -Fhead/-Ftail/-Fmidオプション指定時に利用される(ver2.1追加)
      $HEADTIME  : 内部では$HEADFRAMEと同じ。時間表記で表示される(ver3.0追加)
      $TAILTIME  : 内部では$TAILFRAMEと同じ。時間表記で表示される(ver3.0追加)
       ※$HEADTIME,$TAILTIMEは説明個別記載あるコマンドでも利用(ver3.0追加)
         $HEADFRAMEと$HEADTIME、$TAILFRAMEと$TAILTIMEはどちらでも使用可能
    他にシステム変数として使用される変数は下記
      $POSHOLD  : GetPosコマンド使用時に代入される(ver3.0追加)
      $LISTHOLD : GetListコマンド使用時に代入される(ver3.0追加)
    設定値は""で囲むことで空白を含めた設定可能(ver3.0追加)
    設定値内で変数が使われた場合はその場で展開され、演算が使われた場合は
    そのままで使用時に展開される。(ver3.0説明文を追加)

  EvalTime 変数名 数式
  EvalNum 変数名 数式
    どちらも数式を演算して結果を変数に設定。(ver3.0追加)
    EvalTimeは数式を時間演算として扱い、EvalNumは整数として扱う。
    EvalNumで数式に時間を使った時は秒数の整数として扱う。

  EvalFrame 変数名 数式
    EvalTimeと同じ演算でEvalTime使用を推奨。(ver3.0追加)
    フレーム数表記でEchoコマンドによる表示用に追加。

  NextTail S/B 中心指定 範囲先頭 範囲末尾
    現在の$TAILTIME位置を基準として指定フレーム範囲内に無音シーンチェンジが
    ある場合、中心指定に一番近い場所を$TAILTIMEに設定し、
    元の$TAILTIME値は$HEADTIMEに設定する。(ver3.0追加)
    複数話構成の範囲移動を想定。
    NextTailのS/B指定は、B指定時は無音シーンチェンジ箇所全部を候補として、
    S指定時はその中でもロゴ開始箇所があれば最優先として選択する。

  GetPos S/E/B 中心指定 範囲先頭 範囲末尾
    ロゴ位置を基準に無音シーンチェンジ場所を探す。(ver3.0追加)
    指定範囲内にあれば、中心指定に最も近い場所を変数($POSHOLD)に代入する。
    なければ変数($POSHOLD)は変更しない。

  GetList S/E/B 中心指定 範囲先頭 範囲末尾
    ロゴ位置を基準に無音シーンチェンジ場所を各ロゴで探す。(ver3.0追加)
    指定範囲内にあれば、中心指定に最も近い場所を変数($LISTHOLD)に代入する。
    なければ変数($LISTHOLD)は文字列なしになる。
    GetPosとは違い複数項目文字列のため演算数値としては使用できない。
    -TgtLimitオプションでこのコマンド結果を利用できる。

  DivFile S/E/B 指定位置
    ロゴ位置を基準に指定位置だけ補正した場所をファイル分割位置とする。(ver3.06n追加)
    無音シーンチェンジ情報は使わない。

  Call ファイル名
    現実行スクリプトと同じフォルダにある別実行スクリプトを読み込み実行。
    実行後は現実行スクリプトに戻るので設定等を別ファイルにする使い方など可能。

  Echo 文字列
    文字列を表示。変数は展開される。デバッグ目的で追加(ver2.1追加)

  AutoCut
  AutoAdd
  AutoEdge
  AutoIns
  AutoDel
  AutoCM
  AutoUp
  SetParam
    推測した番組構成からカット位置を決めるコマンド。
    内容は別の説明ファイルに記載。


■実行コマンド（初期設定）

  検索コマンド（変数設定やCallを除く実行コマンド）を使用する前に設定する。

  LogoOff
     ロゴを読み込んでいても無効化する。(ver3.0追加)

  OptDefault 引数文字列
  OptSet  引数文字列
    起動時のオプションのうち検出パラメータを指定可能(ver3.0追加)
    -を含め起動時と同じ文字列を羅列する。
    どちらもオプション更新するが、OptDefaultは未指定項目のみ反映される。
    指定可能項目は下記の通り。
    -CutMrgIn,-CutMrgOut,-CutMrgWI,-CutMrgWO,-flags,-set

  OldAdjust 値
    旧バージョンで使用していた不明確ロゴ位置調整を使用する場合は値=1を設定する。
    0またはコマンドがない場合は使用しない。(ver3.0追加)

  UnitSec 値
    期間設定に整数を記載した場合の単位(ver3.0追加)
    値が0の時はフレーム数、1の時は秒数として計算する。初期状態は0。
    この設定に関係なく期間に秒数を設定したい場合は小数点を記載、
    フレーム数を設定したい場合はF(フレーム数)と記載で可能。
    ※このコマンドは追加したが既存スクリプトでは未使用。


■条件分岐コマンド

  If フラグ フラグ フラグ
    【実行コマンド】
  ElsIf フラグ フラグ フラグ
    【実行コマンド】
  Else
    【実行コマンド】
  EndIf

    If条件に記載のフラグが１つでも起動時オプションまたは変数定義であるか判断。
      定義あり：次のElsIf/Else/EndIfが現れるまでの実行コマンドを実行
      定義なし：実行せず次のElsIf/Else/EndIf以降に移る
    ElsIfはIf以降条件を一度も満たしてなければIfと同じ処理をする。
    ElseはIf以降条件を一度も満たしてなければ無条件で実行する。
    ElsIf/Elseは省略可能。
    フラグと通常の変数共通化により定義は下記内容とする。
       定義あり：フラグ定義済みまたは変数設定値=1
       定義なし：フラグ・変数どちらも未定義または変数設定値=0
    フラグの先頭１文字に!を追加したら定義ありなしを反転して判断。(ver2.1追加)
    フラグのかわりに条件比較も可能で詳細は後述。


■繰り返しコマンド

  Repeat 回数
    【実行コマンド】
  EndRepeat

    RepeatからEndRepeatまでの間を指定回数だけ繰り返し実行する。(ver3.0追加)


■オプション一覧

オプションで実行コマンド適用する箇所を限定する。
記載中、１つ前のロゴ位置とは、
  ロゴ終了位置の場合：ロゴ開始位置
  ロゴ開始位置の場合：１つ前のロゴ終了位置
を表す。

★ ロゴ情報で決まるオプション（基準ロゴ位置の変更は無関係なオプション）

  -N 番号
    何番目のロゴ表示に対するコマンドか決定する。
    負の時は最後から数えた番号を表す。
    0またはオプションなしの場合は制限しないことを表す。

  -NR 番号
    既にAbortコマンドで無効化された位置は飛ばして
    何番目のロゴ表示に対するコマンドか決定する。
    負の時は最後から数えた番号を表す。
    0またはオプションなしの場合は制限しないことを表す。

  -Nlogo 番号
  -Nauto 番号
    $HEADTIME,$TAILTIMEを設定していたら範囲を限定し（なければ全体）、
    範囲内で何番目のロゴ表示に対するコマンドか決定する。(ver3.0追加)
    負の時は最後から数えた番号を表す。
    0またはオプションなしの場合は制限しないことを表す。
    -Nlogoは実際のロゴ位置指定するコマンド(Find等)で使用でき、
    -Nautoは推測構成のロゴ扱い構成をロゴ位置とするAuto系コマンドで使用できる。

  ※-N,-NR,-Nlogo,-Nautoはいずれか１つだけ１コマンドにつき１回指定可。
    番号はコンマで区切って複数指定可能(ver3.0追加)

  -F 範囲先頭 範囲末尾
    対象ロゴ位置が指定フレーム範囲内にある場合のみ対象とする。
    制限不要の場合は-1を入れる。

  -FR 範囲先頭 範囲末尾
    先頭ロゴ（オプション -NR 1 相当）開始位置をフレーム0として、
    対象ロゴ位置が指定フレーム範囲内にある場合のみ対象とする。

  -Fhead 範囲先頭 範囲末尾
    先頭フレームを基準に指定フレーム範囲内にある場合のみ対象とする。
    ただし最初のロゴ開始と最後のロゴ終了の中間地点までに位置制限かけ、
    自動的に全体の後半フレームが範囲に入らないようにする。

  -Ftail 範囲先頭 範囲末尾
    最終フレームを基準に前方方向指定フレーム範囲内にある場合のみ対象とする。
    ただし最初のロゴ開始と最後のロゴ終了の中間地点までに位置制限かけ、
    自動的に全体の前半フレームが範囲に入らないようにする。

  -Fmid 範囲先頭 範囲末尾
    範囲先頭は先頭フレームを基準、範囲末尾は最終フレームを基準に指定フレーム
    中間側に移動した位置の間を対象範囲とする。
    範囲先頭、範囲末尾はそれぞれ-Fhead,-Ftailの位置制限がかかる。

  -FheadX
  -FtailX
  -FmidX
    それぞれ-Fhead,-Ftail,-Fmidと同じ扱い。中間地点までの位置制限が
    かからないことだけ異なる。(ver3.0追加)

    ※-Fhead,-Ftail,-Fmid共通で(ver2.1追加)
    変数$HEADFRAMEが設定済みなら先頭フレーム・最初のロゴ開始として使用される。
    変数$TAILFRAMEが設定済みなら最終フレーム・最後のロゴ終了として使用される。
    $HEADFRAME,$TAILFRAMEともに初期値=-1で、-1の時は設定なし扱い。
    $HEADTIME,$TAILTIMEも同じ扱い(ver3.0追加)

    -F,-FR,-Fhead,-Ftail,-Fmidはいずれか１つだけ１コマンドにつき１回指定可。
    範囲指定に制限不要の場合は-1を入れる。
    -F系コマンドは基準ロゴと結果位置の両方に範囲制約かかる。

  -TgtLimit 範囲先頭 範囲末尾
    変数($LISTHOLD)に記載されたリスト各項目位置を基準に指定フレーム範囲シフト
    した位置内部に対象結果がある場合のみ有効とする。(ver3.0追加)
    -TgtLimitは結果位置のみに範囲制約かかる。$LISTHOLDに項目ない時は制約なし。

（例）-TgtLimit -4.0 5.0
    変数($LISTHOLD)の値が「25.0,45.0」だったとすると、
    結果位置は21秒〜30秒または41秒〜50秒の時だけに制限される。


  -LenP 最低フレーム数 最高フレーム数
    １つ前のロゴ位置から対象ロゴ位置までのフレーム数が指定内の場合のみ
    対象とする。制限不要の場合は-1を入れる。

  -LenN 最低フレーム数 最高フレーム数
    対象ロゴ位置から１つ先のロゴ位置までのフレーム数が指定内の場合のみ
    対象とする。制限不要の場合は-1を入れる。

  -wide
    ロゴ検出に不確定度があり可能性範囲がある場合、可能性範囲内に検索範囲
    を広げて無音シーンチェンジ場所を探す。Find用オプション。

  -WithP
    Abortを実行した時に１つ前の位置も（既に確定していても）一緒にAbortする。
    Abort用オプション。

  -WithN
    Abortを実行した時に１つ後の位置も（既に確定していても）一緒にAbortする。
    Abort用オプション。

  -noedge
    無音シーンチェンジ位置を検索する時に0フレームと最終フレームは除く。

  -flat
    無音シーンチェンジ選択時の内部優先順位情報を使用しない。
    Selectコマンドは指定しなくても最初からこのオプションを付けた状態。

  -autochg
    ロゴ選択位置情報を推測構成（Auto系コマンド）に反映させる。(ver2.1追加)
    Auto系ではない従来認識には反映させない変更。(ver2.2追加)
    従来認識に反映させる場合はこのオプションなしでもう一度同じコマンドを設定。
    Find/Force用オプション。


★ 基準ロゴ位置を変更するオプション
  （Find/Force/MkLogo/Select/DivFileコマンドおよび対応オプションの基準ロゴ位置を変更）

  -fromlast
    基準ロゴ位置を１つ前のロゴ位置に変更する。

  -Shift 中心指定 範囲先頭 範囲末尾
    指定範囲内の無音シーンチェンジ位置を基準ロゴ位置とする。
    他のロゴ情報で決まるオプションで絞り込んでも複数候補が残った場合は、
    中心指定に最も近い場所を基準ロゴ位置としてコマンドを実行する。

  -relative
    結果位置を基準位置として基準ロゴ位置から検索するオプションを実行する。
    (ver3.0追加)

  -fromabs フレーム位置
    基準ロゴ位置を指定フレーム位置とする。負の値の時はコマンドを無効とする。

  -fromhead フレーム位置
    $HEADTIMEからの指定フレーム後の位置を基準ロゴ位置とする。(ver3.0追加)
    負の値の時はコマンドを無効とする。

  -fromtail フレーム位置
    $TAILTIMEからの指定フレーム手前位置を基準ロゴ位置とする。(ver3.0追加)
    負の値の時はコマンドを無効とする。


★ 基準ロゴ位置から検索するオプション

  -SC 範囲先頭 範囲末尾
    基準ロゴ位置からの指定フレーム範囲内に無音シーンチェンジがある場合のみ
    対象とする。負の値を入れることで対象ロゴ以前の位置指定も可能。
    -1を入れた時のみ制限なしとする。（範囲先頭-1は小さいフレーム側制限なし、
    範囲末尾-1は大きいフレーム側制限なし。）
    MkLogoコマンドでは変更指定なければ仮想ロゴ開始位置が基準ロゴ位置となる。
    DivLogoコマンドでは変更指定なければ分割候補位置が基準ロゴ位置となる。
    Selectコマンドでは選択後の無音シーンチェンジが基準ロゴ位置となる。

  -NoSC 範囲先頭 範囲末尾
    -SCとは逆に基準ロゴ位置からの指定フレーム範囲内に無音シーンチェンジがない
    場合のみ対象とする。設定値の仕様は-SCオプションと同じ。

  -SM 範囲先頭 範囲末尾
    基準ロゴ位置からの指定フレーム範囲内に無音期間がある場合のみ
    対象とする。

  -NoSM 範囲先頭 範囲末尾
    -SMとは逆に基準ロゴ位置からの指定フレーム範囲内に無音期間がない場合のみ
    対象とする。

  -SMA 範囲先頭 範囲末尾
    基準ロゴ位置からの指定フレーム範囲内全体が無音期間だった場合のみ
    対象とする。

  -NoSMA 範囲先頭 範囲末尾
    基準ロゴ位置からの指定フレーム範囲内に無音ではない期間がある場合のみ
    対象とする。(ver3.0追加)

  -AC 範囲先頭 範囲末尾
    基準ロゴ位置からの指定フレーム範囲内に推測構成区切りがある場合のみ
    対象とする。(ver3.0追加)

  -NoAC 範囲先頭 範囲末尾
    基準ロゴ位置からの指定フレーム範囲内に推測構成区切りがない場合のみ
    対象とする。(ver3.0追加)

  -RSC,-RNoSC,-RSM,-RNoSM,-RSMA,-RNoSMA,-RAC,-RNoAC
    先頭にRをつけた場合は結果位置を基準位置とする。(ver3.0追加)
    対象オプション全部にRをつけたら -relative と同じ。
    基準位置の違いだけで設定はRを抜いたオプションを参照。


★ ２点指定コマンド用(MkLogo, AutoIns, AutoDel)のオプション

  -EndLen 中心指定 範囲先頭 範囲末尾
    仮想ロゴ開始位置を基準として指定範囲内に無音シーンチェンジがあれば
    中心指定に一番近い所を終了位置とする。なければMkLogoを実行しない。
    MkLogo用オプション。AutoIns, AutoDelでも使用可能。

  -EndHead
    $HEADTIMEを終了位置とする。(ver3.0追加)

  -EndTail
    $TAILTIMEを終了位置とする。(ver3.0追加)

  -EndHold
    直前のGetPosコマンドで取得した位置をを終了位置とする。(ver3.0追加)
    実際には変数($POSHOLD)の位置。


★ MkLogoコマンド用のオプション

  -overlap
    仮想ロゴ範囲内に既存ロゴがあっても有効とする。
    重なった既存ロゴの開始終了位置は仮想ロゴの境界位置まで移動する。
    MkLogo用オプション。

  -confirm
    Findコマンドを待たずにロゴ位置を即時確定する。
    MkLogo用オプション。SelectおよびDivLogoでも使用可能。

  -unit
    他領域のロゴと重なってもTrimは作成ロゴだけで分離して出力する。
    MkLogo用オプション。

  -else
    直前のコマンドを実行した場合は実行対象外とする。
    直前コマンド実行により対象外となった場合は実行扱いとするため、複数コマンド
    で-elseオプションを続けた場合は１つ実行した時点で以降は実行対象外となる。
    MkLogo用に作成したオプション。

  -cont
    直前のコマンドを実行した場合のみ実行対象とする。
    実行対象となった場合このコマンド実行有無に関わらず実行扱いとするため、
    次のコマンドでは前コマンド実行状態を継続する。


★ DivLogo(GetPos,GetList,AutoIns,AutoDel)コマンド用のオプション

  -force
    指定範囲内に無音シーンチェンジがない場合、無音シーンチェンジ以外の条件を
    満たしていれば強制的に指定中心位置で分割する。(ver2.1追加)
    GetPos/GetList/AutoIns/AutoDelでも使用可能で、無音シーンチェンジがない場合は
    指定中心位置に無音シーンチェンジを作成して設定する。(ver3.0追加)

  -noforce
    GetPos/GetListのみで有効なコマンド。(ver3.0追加)
    -force実行時の位置を取得するが、実際の無音シーンチェンジ作成は行わない。


★ Selectコマンド用のオプション

  -reset
    自動または事前Selectコマンドでロゴ位置を選択できている時でも再選択する。

  -logoext 前側補正フレーム 後側補正フレーム
    ロゴ可能性範囲を補正。前側は負の値、後側は正の値で拡張する。
    -1の時は指定側のフレーム制限なしとする。


■フレーム指定方法

オプション中フレーム数は数値入力で指定できるが、時間指定も可能にした。
小数点を記載することで秒数指定も可能にした。
整数記載がフレーム数か秒数か明示をF(整数値) S(整数値)で可能にした。(ver3.0追加)
（指定例）
1234          1234フレーム（初期設定時）
01:23:45.678  1時間23分45秒678ミリ秒
01:23:45      1時間23分45秒
11:23.456     11分23秒456ミリ秒
00:34.5       34秒500ミリ秒
00:34         34秒
34.5          34秒500ミリ秒
34.0          34秒
F(23)         23フレーム
S(23)         23秒


■フレーム指定内の演算

単純な加算／減算を可能にした。空白を開けずに+または-を記載で演算を行う。
乗算(*)除算(/)剰余(%)論理演算(|&^)および()による優先順位演算追加。(ver3.0追加)
ただし乗除算の被乗除数（演算子の右側）は時間指定に対応せず必ず整数を指定する。
（例えば時間演算「30*15」は「1秒*0.5秒」でなく「1秒の15倍」として計算される）

（指定例）
Default base 200
Default offset 50
Default w  35
Select S 0 -$w $w -fromabs $base+$offset


■If文の条件比較

If文条件としてフラグの変わりに数値比較演算が可能(ver2.1追加)
論理和(||)論理積(&&)や計算式を使った演算が可能。(ver3.0追加)
フラグをそのまま使用する場合、判別のためフラグとそれ以外文字列の間に空白必須。
$をつけた変数で記載する場合やフラグ使用しない場合は空白不要。(ver3.0追加)
条件の項目内で１箇所でも:または.を使っていたら時間演算としてミリ秒に変換、
それ以外の時は整数として扱う。

（記載方法）
  If 数値A 比較演算子 数値B
（比較演算子）
  == AとBが等しい
  != AとBが異なる
  <  AよりBが大きい
  <= AよりBが大きいか等しい
  >  AよりBが小さい
  >= AよりBが小さいか等しい
  || AとBのどちらかが0以外
  && AとBの両方0以外
（指定例）
Default base 200
Default offset 50
Default w  35
If $base >= 0
  Select S 0 -$w $w -fromabs $base+$offset
EndIf
